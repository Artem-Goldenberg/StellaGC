# Сборщик мусора для языка `Stella`

Сборщик мусора по поколениям, можно настраивать количество поколений, размер отрезков, количество отрезков в каждом поколении через макросы в `stella/gc.h`.

Для отслеживания указателей из старых поколений на новые используется битовый массив, который помечает те клетки памяти(карточки), где лежат указатели на более молодое поколение. Клетки помечаются через барьер на запись, их размер также можно изменять через макрос в `stella/gc.h`. Сборка мусора происходит, когда первый отрезок самого молодого поколения заполнился. 

### Параметры сборщика
Как первые макросы в `stella/gc.h`

- `NGENS`: количество поколений, включая самое новое поколение
- `MAX_ALLOC_SIZE`: размер **отрезка** первого поколения (не включая размер отрезка в to-space, который равен ему)
- `GEN_SIZE(prevSize)`: размер **отрезка** следующего поколения, основывая на размере отрезка предыдущего поколения
- `NSEGMENTS(gen)`: количество отрезков для каждого поколения (`0 <= gen < NGENS`)
- `CELL_SIZE`: размер клетки памяти, которая помечает указатели на молодые поколения

**Сейчас нужно обязательно задавать параметры так, чтобы размер каждого отрезка делился на `CELL_SIZE * 8`**

### Сборка

Через `make`: нужно установить компилятор стеллы через [докер](https://hub.docker.com/r/fizruk/stella)

В папке `Examples` лежат примеры программ, которые можно компилировать и запускать со сборщиком мусора.  
Чтобы скомпилировать например `factorial.stella`, нужно сделать `make factorial`.   
Дальше можно запускать: `./factorial`.  
Список всех целей можно быстро посмотреть через `make help` или просто `make`.   

Перекомпилировать, чтобы выводилась отладочная информация:
```bash
make clean
make factorial DEBUG=1
./factorial
```
Если поставить `DEBUG` на 2, то будет еще дополнительно выводится стек трейс.  

> Вы можете добавить исходные файлы stella в папку `Examples` и добавить в мейкфайл к переменной `targets` 
> через пробел имя файла без расширения `.stella`, тогда можно будет собирать и запускать программу так же как и остальные

Убрать все сгенерированные файлы: `make clean`
